---
- name: "Run roles"
  hosts: "localhost"
  become: true

  vars:
    duplicati_docker_settings:
      duplicati_env:
        SETTINGS_ENCRYPTION_KEY: "supersecret"

    forgejo_docker_settings:
      # FIXME: this is needed to fix '/var/lib/gitea/git': Permission denied errors.
      puid: "{{ puid }}"
      pgid: "{{ pgid }}"

    rss_docker_settings:
      # FIXME: miniflux can't resolve database with 'miniflux-db', so we need to put both containers in the same network.
      network: "rss"

    wgeasy_docker_settings:
      network: "host"

  pre_tasks:
    - include_role:
        name: "artyorsh.selfhosted.docker"

  roles:
    - { role: "artyorsh.selfhosted.authelia", tags: "authelia" }
    - { role: "artyorsh.selfhosted.duplicati", tags: "duplicati" }
    - { role: "artyorsh.selfhosted.glances", tags: "glances" }
    - { role: "artyorsh.selfhosted.forgejo", tags: "forgejo" }
    - { role: "artyorsh.selfhosted.homebox", tags: "homebox" }
    - { role: "artyorsh.selfhosted.rss", tags: "rss" }
    - { role: "artyorsh.selfhosted.nginx", tags: "nginx" }
    - { role: "artyorsh.selfhosted.paperlessngx", tags: "paperlessngx" }
    - { role: "artyorsh.selfhosted.vaultwarden", tags: "vaultwarden" }
    - { role: "artyorsh.selfhosted.wallos", tags: "wallos" }
    - { role: "artyorsh.selfhosted.wgeasy", tags: "wgeasy" }
